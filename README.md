This is a mess, will refactor later
